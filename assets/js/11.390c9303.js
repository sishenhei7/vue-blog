(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{177:function(t,e,s){"use strict";s.r(e);var r=s(0),n=Object(r.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("PWA 简称：Progressive Web App")]),t._v(" "),s("p",[t._v("特点：")]),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("用的技术栈：")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),s("p",[t._v("下面是"),s("code",[t._v("name")]),t._v("参数的示例：\n"),s("img",{attrs:{width:"80%",src:t.$withBase("/pwa-name.png")}})]),t._v(" "),s("p",[t._v("下面是"),s("code",[t._v("background-color")]),t._v("参数的示例：\n"),s("img",{attrs:{src:t.$withBase("/pwa-background-color.gif")}})]),t._v(" "),s("p",[t._v("下面是"),s("code",[t._v("theme-color")]),t._v("参数的示例：\n"),s("img",{attrs:{src:t.$withBase("/pwa-theme-color.png")}})]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),s("p",[t._v("下面是 SW 的生命周期：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/vuejs/vuepress/blob/0d56a9908574e0dd7e8b215787ac6ab01e589f11/packages/%40vuepress/plugin-pwa/lib/enhanceAppFile.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vuepress/plugin-pwa 的源码"),s("OutboundLink")],1)]),t._v(" "),t._m(17),t._v(" "),s("p",[s("strong",[t._v("下面是一个新的 SW 生命周期示意图：")]),t._v(" "),s("img",{attrs:{width:"80%",src:t.$withBase("/sw-new.png")}})]),t._v(" "),s("p",[s("strong",[t._v("下面是一个新的 SW 取代旧的 SW 的示意图：")]),t._v(" "),s("img",{attrs:{width:"80%",src:t.$withBase("/sw-old.png")}})]),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("参见我的具体操作。")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),s("p",[s("a",{attrs:{href:"https://codelabs.developers.google.com/codelabs/your-first-pwapp/#0",target:"_blank",rel:"noopener noreferrer"}},[t._v("教程文档"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"http://localhost:8089/",target:"_blank",rel:"noopener noreferrer"}},[t._v("案例地址"),s("OutboundLink")],1)]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),s("p",[s("a",{attrs:{href:"https://codelabs.developers.google.com/codelabs/push-notifications/#0",target:"_blank",rel:"noopener noreferrer"}},[t._v("教程文档"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"http://localhost:8020/",target:"_blank",rel:"noopener noreferrer"}},[t._v("案例地址"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://web-push-codelab.glitch.me/",target:"_blank",rel:"noopener noreferrer"}},[t._v("push server 地址"),s("OutboundLink")],1)]),t._v(" "),t._m(23),t._v(" "),s("p",[t._v("谷歌有一款插件叫做"),s("a",{attrs:{href:"https://developers.google.com/web/tools/workbox/",target:"_blank",rel:"noopener noreferrer"}},[t._v("workbox.js"),s("OutboundLink")],1),t._v("。它使用的"),s("strong",[t._v("缓存策略")]),t._v("是：")]),t._v(" "),t._m(24),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("Vue 官方文档的刷新小窗原理")]),t._v(" "),s("p",[s("code",[t._v("workbox.js")]),t._v(" 自己实现了很多钩子，其中就有"),s("code",[t._v("update")]),t._v("钩子(详细见文档"),s("a",{attrs:{href:"https://developers.google.com/web/tools/workbox/modules/workbox-broadcast-update?hl=en",target:"_blank",rel:"noopener noreferrer"}},[t._v("What is Broadcast Update?"),s("OutboundLink")],1),t._v(")，这是专门针对"),s("strong",[t._v("StaleWhileRevalidate")]),t._v("所做的钩子，因为这个缓存策略在使用缓存的时候，同时也会发出网络请求，请求最新数据，当所有的数据请求完成之后，它会判断新的缓存和旧的缓存是否有变动，如果有的话，就广播 update 事件。然后 Vue 官方文档监听了 update 事件，如果监听到了，就弹出小窗让我们刷新。")])]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("官方插件")]),t._v(" "),s("p",[s("strong",[t._v("Vue 官方")]),t._v(" 对上面的 "),s("code",[t._v("workbox.js")]),t._v(" 做了一定的封装，开发了 "),s("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vue/cli-plugin-pwa"),s("OutboundLink")],1),t._v(" 插件，这个插件仅仅是做简单的封装而已，需要我们"),s("strong",[t._v("自己配置缓存策略")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("Nuxt 官方")]),t._v(" 也对上面的 "),s("code",[t._v("workbox.js")]),t._v(" 做了一定的封装，开发了"),s("a",{attrs:{href:"https://pwa.nuxtjs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("@nuxtjs/pwa"),s("OutboundLink")],1),t._v(" 插件，这个插件使用的"),s("strong",[t._v("缓存策略")]),t._v("是：")]),t._v(" "),t._m(25)]),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://juejin.im/post/5a2de466f265da430b7b2dc9",target:"_blank",rel:"noopener noreferrer"}},[t._v("讲讲 PWA"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://medium.com/@jasminejacquelin/integrating-push-notifications-in-your-node-react-web-app-4e8d8190a52c#9a53",target:"_blank",rel:"noopener noreferrer"}},[t._v("Integrating Push Notifications in your Node/React Web App"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://codelabs.developers.google.com/?cat=Web",target:"_blank",rel:"noopener noreferrer"}},[t._v("codelabs"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle",target:"_blank",rel:"noopener noreferrer"}},[t._v("lifecycle"),s("OutboundLink")],1)])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"pwa"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pwa","aria-hidden":"true"}},[this._v("#")]),this._v(" PWA")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" 介绍")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("说明，我只是简单介绍，并没有太深入，但深度还是有的")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("strong",[t._v("可靠")]),t._v("：网络不稳定，也能瞬间加载和展现")]),t._v(" "),s("li",[s("strong",[t._v("快速响应")]),t._v("：用户操作后的响应非常快速")]),t._v(" "),s("li",[s("strong",[t._v("粘性")]),t._v("：像原生应用一样，沉浸式（可以添加到桌面，推送服务）")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("manifest.json")]),this._v(" "),e("li",[this._v("service worker")]),this._v(" "),e("li",[this._v("cache api")]),this._v(" "),e("li",[this._v("background services(Fetch && Sync)(后台同步)")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"manifest-文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#manifest-文件","aria-hidden":"true"}},[this._v("#")]),this._v(" manifest 文件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("manifest 文件控制了"),e("strong",[this._v("当 web app 安装到移动端的时候，应该怎么表现")]),this._v("。这是一个完整的 manifest.json 文件示例：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('{\n  "short_name": "Maps",\n  "name": "Google Maps",\n  "icons": [\n    {\n      "src": "/images/icons-192.png",\n      "type": "image/png",\n      "sizes": "192x192"\n    },\n    {\n      "src": "/images/icons-512.png",\n      "type": "image/png",\n      "sizes": "512x512"\n    }\n  ],\n  "start_url": "/maps/?source=pwa",\n  "background_color": "#3367D6",\n  "display": "standalone", // fullscreen,standalone,minimal-ui,browser\n  // "orientation": "landscape",\n  "scope": "/maps/",\n  "theme_color": "#3367D6"\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下面是引入 "),e("code",[this._v("manifest")]),this._v(" 文件的方法：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('\x3c!-- index.html --\x3e\n<link rel="manifest" href="/manifest.json">\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当然我们也可以利用 "),e("code",[this._v("meta")]),this._v(" 更改 "),e("code",[this._v("theme-color")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('// 更改 theme-color 的 meta\n<meta name="theme-color" content="#4285f4">\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"service-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-worker","aria-hidden":"true"}},[this._v("#")]),this._v(" service worker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("service worker，简称 SW ，有 3 个坑：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("虽然 SW 只能在"),s("code",[t._v("https")]),t._v("环境下运行，但是它也能在"),s("code",[t._v("localhost")]),t._v("或者"),s("code",[t._v("217.0.0.1")]),t._v("这个 host 下运行。")]),t._v(" "),s("li",[t._v("SW 是有"),s("strong",[t._v("作用域")]),t._v("的，作用域是 SW 注册文件的放置目录。")]),t._v(" "),s("li",[t._v("SW 从下载到激活再到代理 http 请求是有"),s("strong",[t._v("延迟性")]),t._v("的。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("SW 的作用域")]),this._v(" "),e("p",[this._v("比如说如果项目主目录是 ./，然后 sw.js 的文件目录是 ./foo/sw.js，那么 SW 的作用域就是 foo，它只能处理 /foo/xxxx 这个地址下的 http 请求。(最佳实践：把 sw.js 放在主目录下面，即放到这个文件目录：./sw.js)。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("SW 的生命周期")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("strong",[t._v("install")]),t._v(": 当 SW 下载完成之后，就会执行 install，安装 SW。注意，在这个阶段，SW 对页面是不起作用的，并不能代理 http 请求。")]),t._v(" "),s("li",[s("strong",[t._v("active")]),t._v(": 当 SW 安装完成之后，并不会立即适用，它会在下次页面刷新或者打开的时候才会适用，所以初次打开页面的时候 SW 并不能代理 http 请求。如果这个时候页面已经有老的 SW，那么老的 SW 仍然会继续运行。")]),t._v(" "),s("li",[s("strong",[t._v("waiting")]),t._v(": 在 install 和 active 之间 SW 是属于 waiting 阶段，这个严格来说并不是生命周期，因为它没有一个回调。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("SW 的调试")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"简单制作-pwa"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简单制作-pwa","aria-hidden":"true"}},[this._v("#")]),this._v(" 简单制作 PWA")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("说明目的")]),t._v(" "),s("p",[t._v("实际体验一下 pwa 的缓存效果和基本操作")]),t._v(" "),s("ol",[s("li",[t._v("注册 SW（self.skipWaiting 的使用）")]),t._v(" "),s("li",[t._v("缓存离线页（缓存离线页，判断请求来源，请求失败则跳转离线页）")]),t._v(" "),s("li",[t._v("缓存 app 请求")]),t._v(" "),s("li",[t._v("SW 的延迟性")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"web-push"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-push","aria-hidden":"true"}},[this._v("#")]),this._v(" web push")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("说明目的")]),t._v(" "),s("p",[t._v("实际体验一下 web push 的实际 coding 过程 和原理")]),t._v(" "),s("ol",[s("li",[t._v("浏览器向服务端请求 web app。")]),t._v(" "),s("li",[t._v("服务端返回 web app 给客户端，同时浏览器安装 SW。")]),t._v(" "),s("li",[t._v("浏览器的 SW 向 google cloud 注册 push 功能。（需要翻墙）")]),t._v(" "),s("li",[t._v("google cloud 返回给浏览器 token。")]),t._v(" "),s("li",[t._v("浏览器把 token 发送给 服务端。")]),t._v(" "),s("li",[t._v("服务端给浏览器返回消息确认 token 已收到。")]),t._v(" "),s("li",[t._v("当服务端需要进行 web push 的时候，把 push 内容发送给 google cloud，然后 google cloud 推送给浏览器。（需要翻墙）")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"实际应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实际应用","aria-hidden":"true"}},[this._v("#")]),this._v(" 实际应用")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("strong",[t._v("StaleWhileRevalidate")]),t._v("：同时从网络与缓存获取，如果缓存可用，取缓存数据，同时会把网络请求的数据缓存起来；否则从网络中请求，并更新缓存。")]),t._v(" "),s("li",[s("strong",[t._v("CacheFirst(缓存优先)")]),t._v("：优先取缓存中的数据，若没有则请求网络，请网络也失败就会报错。")]),t._v(" "),s("li",[s("strong",[t._v("NetworkFirst(网络优先)")]),t._v("：优先从网络获取，若没有则从缓存中获取，缓存获取失败则报错。")]),t._v(" "),s("li",[s("strong",[t._v("CacheOnly(仅缓存)")]),t._v("：只从缓存中获取，若没有则报错。")]),t._v(" "),s("li",[s("strong",[t._v("NetworkOnly(仅网络)")]),t._v("：只从网络获取，若没有则报错。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("对 webpack 没有打包的资源(static 文件夹)：网络优先")]),this._v(" "),e("li",[this._v("对 webpack 打包的资源(_nuxt 文件夹)：缓存优先")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("结合我们的项目")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("官网项目：需要，不解释。")]),this._v(" "),e("li",[this._v("后台项目：api 请求是实时的，不需要；对于静态资源，可以考虑缓存 js，css 和 字体（但是有其它更好的储存方法）。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"目前的困境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目前的困境","aria-hidden":"true"}},[this._v("#")]),this._v(" 目前的困境")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("PWA 虽然有这么棒的离线体验，但是它还没有得到广泛的运用，原因有以下几点：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("iOS11.3 之前都"),s("strong",[t._v("不支持")])]),t._v(" "),s("li",[t._v("web push 需要客户端"),s("strong",[t._v("翻墙")]),t._v("来连接 GCM(Google Cloud Messaging)")]),t._v(" "),s("li",[t._v("微信小程序的"),s("strong",[t._v("竞争")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资料")])}],!1,null,null,null);e.default=n.exports}}]);